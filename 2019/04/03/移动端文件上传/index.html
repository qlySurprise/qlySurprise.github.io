
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>好嗨哦</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="vue项目如何打包扔向服务器Vue应用部署到服务器的正确方式当我们将 vue 项目完成后，面临的就是如何将项目进行打包上线，放到服务器中。我使用的是 vue-cli（simple） 脚手架，所以就讲,"> 
    <meta name="author" content="qly"> 
    <link rel="alternative" href="atom.xml" title="好嗨哦" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">移动端文件上传</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">移动端文件上传</h1>
        <div class="stuff">
            <span>四月 03, 2019</span>
            

        </div>
        <div class="content markdown">
            <p>移动端公众号微信上传功能：<br>a.  ios可以实现图片多选，支持图片视频同时选择<br>b. 安卓只支持选择单个文件，不支持同时选择图片和视频（qq浏览器支持多选）<br>c. js-sdk实现上传，安卓和ios 可以实现多选图片，不支持图片视频同时选择</p>
<p>input方式：<br>1.Blob对象 </p>
<p>Blob表示原始二进制数据,Html5的file对象就继承于它，它提供以下属性：<br>type：mime类型,如果是未知类型则返回一个空字符串<br>size：Blob对象的字节长度</p>
<p>2.input(type=“file”)控件与file&amp;FileList对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; accept=&quot;image/*” multiple id=“file&quot;/&gt;</span><br><span class="line">见上述代码：</span><br></pre></td></tr></table></figure></p>
<p>multiple：表示file控件允许一次放置多个文件<br>accept：用来让input只能接受某种类型的文件，但是目前主流浏览器对其的支持都只局限于打开文件选择窗口时，默认选择图片文件而已，如果其他类型文件，file控件也能正常接受。</p>
<p>3.FileReader接口</p>
<p>Filereader接口主要用于读取文件，把文件读入内存，并且读取文件中的数据，FileReader接口提供了一个异步接口(用于在浏览器主线程中异步访问文件系统)，浏览器对FileReader的能力检测代码如下：</p>
<p>if(typeof FileReader == undefined) {</p>
<pre><code>div.innerHTML = &quot;不支持filereader&quot;;
</code></pre><p>}else{</p>
<pre><code>div.innerHTML = &quot;FileReader is ok”;
</code></pre><p>}</p>
<p>FileReader的方法</p>
<p>readAsDataURL:将文件读取为DataURL(base64最为常见)</p>
<p>FileReader的状态</p>
<p>onabort 数据读取中断</p>
<p>onerror 数据读取出错</p>
<p>onloadstart 开始读取数据</p>
<p>onprogress 读取中</p>
<p>onload 读取成功时触发</p>
<p>onloadend 数据读取完成，无论成功失败都触发</p>
<p>在各种方法中，this.result指向读取的文件数据<br>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        *&#123;</span><br><span class="line">            margin:0;</span><br><span class="line">            padding:0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ul,ol&#123;</span><br><span class="line">            list-style-type:none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .clearfix:after,.clearfix:before&#123;</span><br><span class="line"></span><br><span class="line">            display:table;</span><br><span class="line">            content:&apos; &apos;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .clearfix:after&#123;</span><br><span class="line">            clear:both</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .tc&#123;</span><br><span class="line">            text-align:center;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .select,.select_video&#123;</span><br><span class="line">            height:2rem;</span><br><span class="line">            line-height:2rem;</span><br><span class="line">            background:#fff;</span><br><span class="line">            border:1px solid #4285F4;</span><br><span class="line">            margin:0.5rem 1rem;</span><br><span class="line">            position:relative;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .select label,.select_video label&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            position:absolute;</span><br><span class="line">            top:0;</span><br><span class="line">            left:0;</span><br><span class="line">            font-size:14px;</span><br><span class="line">            color:#333;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #upload,#upload_video&#123;</span><br><span class="line">            display:none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .preview,.video_preview&#123;</span><br><span class="line">            margin:0.5rem 1rem;</span><br><span class="line">            border:1px solid #bbb;</span><br><span class="line">            padding:4px;</span><br><span class="line">            display:none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .preview_img_list li&#123;</span><br><span class="line">            float:left;</span><br><span class="line">            width:25%;</span><br><span class="line">            padding:2px 0;</span><br><span class="line"></span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">        .preview_img_list li img&#123;</span><br><span class="line">            vertical-align:top;</span><br><span class="line">            max-width:98%;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .btn&#123;</span><br><span class="line">            background: #4285F4;</span><br><span class="line">            color:#fff;</span><br><span class="line">            height:2.5rem;</span><br><span class="line">            line-height:2.5rem;</span><br><span class="line">            margin:2rem 1rem;</span><br><span class="line">            border-radius:0.5rem;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        window.onload = function()&#123;</span><br><span class="line"></span><br><span class="line">            var uploadBtn = document.querySelector(&apos;#upload&apos;);</span><br><span class="line">            var previewImgList = document.querySelector(&apos;.preview_img_list&apos;);</span><br><span class="line"></span><br><span class="line">            var uploadVideo = document.querySelector(&apos;#upload_video&apos;);</span><br><span class="line">            var submitBtn = document.querySelector(&apos;.submit&apos;);</span><br><span class="line"></span><br><span class="line">            imgArr = new Array();</span><br><span class="line"></span><br><span class="line">            uploadBtn.addEventListener(&apos;change&apos;,function()&#123;</span><br><span class="line">                var imgLen = this.files.length;</span><br><span class="line">                var liLen = previewImgList.getElementsByTagName(&apos;li&apos;).length;</span><br><span class="line">                var ImgLen = imgLen + liLen ;</span><br><span class="line"></span><br><span class="line">                if(ImgLen &gt; 9)&#123;</span><br><span class="line">                    alert(&quot;上传最大数量不能大于9&quot;);</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                document.querySelector(&quot;.preview&quot;).style.display = &apos;block&apos;;</span><br><span class="line"></span><br><span class="line">                for(var i = 0; i &lt; imgLen;i++)&#123;</span><br><span class="line">                    var file = this.files[i];</span><br><span class="line">                    var imgType = /^image\//;</span><br><span class="line"></span><br><span class="line">                    if(!imgType.test(file.type))&#123;</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    var li = document.createElement(&apos;li&apos;);</span><br><span class="line">                    var img = document.createElement(&quot;img&quot;);</span><br><span class="line"></span><br><span class="line">                    li.appendChild(img);</span><br><span class="line">                    previewImgList.appendChild(li); </span><br><span class="line"></span><br><span class="line">                    var reader = new FileReader();</span><br><span class="line">                    reader.onload = (function(aImg) &#123; return function(e) &#123; aImg.src = e.target.result; initHW(); imgArr.push(e.target.result);&#125;; &#125;)(img);</span><br><span class="line">                    reader.readAsDataURL(file);</span><br><span class="line">                    // var objectUrl = window.URL.createObjectURL(file);</span><br><span class="line">                    // img.src = objectUrl;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;,false);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            uploadVideo.addEventListener(&apos;change&apos;,function()&#123;</span><br><span class="line">                var file = this.files[0];</span><br><span class="line">                var videoType = /^video\//;</span><br><span class="line"></span><br><span class="line">                if(!videoType.test(file.type))&#123;</span><br><span class="line">                    alert(&quot;所选文件不是合法的视频文件&quot;);</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                var pv =  document.querySelector(&apos;.video_preview&apos;);</span><br><span class="line">                var video =  document.createElement(&apos;video&apos;);</span><br><span class="line">                video.setAttribute(&apos;controls&apos;,&apos;controls&apos;);</span><br><span class="line">                video.style.width = &quot;100%&quot;;</span><br><span class="line"></span><br><span class="line">                pv.appendChild(video);</span><br><span class="line">                pv.style.display = &quot;block&quot;;</span><br><span class="line">                // var objectUrl = window.URL.createObjectURL(file);</span><br><span class="line">                // video.src = objectUrl;</span><br><span class="line">                // </span><br><span class="line">                var reader = new FileReader();</span><br><span class="line">                reader.onload = (function(aImg) &#123; return function(e) &#123; aImg.src = e.target.result; &#125;; &#125;)(video);</span><br><span class="line">                reader.readAsDataURL(file);</span><br><span class="line">                video.play();</span><br><span class="line">            &#125;,false);</span><br><span class="line"></span><br><span class="line">            submitBtn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">                if(!imgArr.length)&#123;</span><br><span class="line">                    alert(&apos;请选择要上传的图片&apos;);</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">                var form = document.querySelector(&apos;form&apos;);</span><br><span class="line">                var fd = new FormData(form);</span><br><span class="line">                for(var i = 0;i &lt; imgArr.length;i++)&#123;</span><br><span class="line">                    fd.append(&apos;file[]&apos;,imgArr[i]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                var request = new XMLHttpRequest();</span><br><span class="line">                var url = &quot;./file_preview.php&quot;;</span><br><span class="line">                request.open(&apos;post&apos;,url);</span><br><span class="line">                request.send(fd);</span><br><span class="line">            &#125;,false);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 初始化图片宽度</span><br><span class="line">        // 使得图片高度一致</span><br><span class="line">        function initHW()&#123;</span><br><span class="line">            var previewImgList = document.querySelector(&apos;.preview_img_list&apos;);</span><br><span class="line">            var Lis = previewImgList.getElementsByTagName(&apos;li&apos;);</span><br><span class="line"></span><br><span class="line">            var LisLen = Lis.length;</span><br><span class="line"></span><br><span class="line">            if(LisLen &gt; 1)&#123;</span><br><span class="line">                var img = Lis[0].getElementsByTagName(&apos;img&apos;)[0];</span><br><span class="line"></span><br><span class="line">                var imgW = img.width;</span><br><span class="line">                var imgH = img.height;</span><br><span class="line"></span><br><span class="line">                for(var i = 1; i &lt; LisLen; i++)&#123;</span><br><span class="line">                    var img = Lis[i].getElementsByTagName(&apos;img&apos;)[0];</span><br><span class="line">                    img.style.width = imgW + &apos;px&apos;;</span><br><span class="line">                    img.style.height = imgH + &apos;px&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2 class = &quot;tc&quot;&gt;图片上传及预览&lt;/h2&gt;</span><br><span class="line">    &lt;form action=&quot;&quot; &gt;</span><br><span class="line">        &lt;div class=&quot;select tc&quot; &gt;</span><br><span class="line">            &lt;label for=&quot;upload&quot;&gt;图片上传及预览&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;file&quot; id = &quot;upload&quot; multiple=&quot;multiple&quot; accpet = &quot;image/*&quot; capture = &quot;camera&quot; &gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;preview&quot;&gt;</span><br><span class="line">            &lt;ul class = &quot;preview_img_list clearfix&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;select_video tc&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;upload_video&quot;&gt;视频上传及预览&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;file&quot; id = &quot;upload_video&quot; accpet = &quot;video/*&quot; capture = &quot;camcorder&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;video_preview&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;submit btn tc&quot;&gt;上传&lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>js-sdk方式：</p>
<p>html:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;weixin&quot;&gt;上传&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;wei&quot;&gt;AAA&lt;/div&gt;</span><br><span class="line">&lt;img id=&quot;ImgPr&quot; src=&quot;&quot; alt=&quot;&quot;&gt;</span><br><span class="line">&lt;div class=&quot;js_showBox&quot;&gt;aa&lt;/div&gt;</span><br><span class="line">&lt;h2 class = &quot;tc&quot;&gt;图片上传及预览&lt;/h2&gt;</span><br></pre></td></tr></table></figure></p>
<p>js部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">wx.config(&#123;</span><br><span class="line"></span><br><span class="line">    debug: true, //调试阶段建议开启</span><br><span class="line">    appId: &apos;&lt;?php echo $signPackage[&quot;appId&quot;];?&gt;&apos;,</span><br><span class="line">    timestamp: &lt;?php echo $signPackage[&quot;timestamp&quot;];?&gt;,</span><br><span class="line">    nonceStr: &apos;&lt;?php echo $signPackage[&quot;nonceStr&quot;];?&gt;&apos;,</span><br><span class="line">    signature: &apos;&lt;?php echo $signPackage[&quot;signature&quot;];?&gt;&apos;,</span><br><span class="line">    jsApiList: [</span><br><span class="line">       /*</span><br><span class="line">        * 所有要调用的 API 都要加到这个列表中</span><br><span class="line">        * 这里以图像接口为例</span><br><span class="line">        */</span><br><span class="line">          &quot;chooseImage&quot;,</span><br><span class="line">          &quot;previewImage&quot;,</span><br><span class="line">          &quot;uploadImage&quot;,</span><br><span class="line">          &quot;downloadImage&quot;,</span><br><span class="line">        &quot;getLocalImgData&quot;</span><br><span class="line">        ]</span><br><span class="line">  &#125;);</span><br><span class="line">  var btn = document.getElementById(&apos;weixin&apos;);</span><br><span class="line">var bnm = document.getElementById(&apos;wei&apos;);</span><br><span class="line">  //定义images用来保存选择的本地图片ID，和上传后的服务器图片ID</span><br><span class="line">  var images = &#123;</span><br><span class="line">      localId: [],</span><br><span class="line">      serverId: []</span><br><span class="line">  &#125;;</span><br><span class="line">var serverId = [];</span><br><span class="line">  wx.ready(function () &#123;</span><br><span class="line">    var total=1;/*限制上传的数量*/</span><br><span class="line">    var sum=0;/*每次上传的数量*/</span><br><span class="line">    var upsum=0;/*已上传的总数*/</span><br><span class="line">    // 在这里调用 API</span><br><span class="line">    btn.onclick = function()&#123;</span><br><span class="line">        wx.chooseImage (&#123;</span><br><span class="line">          count:1,/*默认为9*/</span><br><span class="line"></span><br><span class="line">          sourceType: [&apos;album&apos;, &apos;camera&apos;],</span><br><span class="line">            success : function(res)&#123;</span><br><span class="line">                 images.localId = res.localIds;  //保存到images</span><br><span class="line">              var localId=res.localIds[0];</span><br><span class="line">                alert(localId);</span><br><span class="line">              if (window.__wxjs_is_wkwebview) &#123;</span><br><span class="line">                alert(localId);</span><br><span class="line">                wx.getLocalImgData(&#123;</span><br><span class="line"></span><br><span class="line">                    localId: localId, // 图片的localID</span><br><span class="line"></span><br><span class="line">                    success: function (res) &#123;</span><br><span class="line">                        var localData = res.localData; </span><br><span class="line">                         alert(localId);</span><br><span class="line">                        // localData = localData.replace(&apos;jgp&apos;, &apos;jpeg&apos;);</span><br><span class="line"></span><br><span class="line">                        // $(&quot;#ImgPr&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">                        // $(&quot;.js_showBox&quot;).append(&quot;&lt;img src=&apos;&quot;+localData+&quot;&apos; /&gt;&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;</span><br><span class="line">                /*相应位置预览*/</span><br><span class="line">                var count=res.localIds.length+upsum;</span><br><span class="line">                for(j=upsum;j&lt;count;j++)&#123;</span><br><span class="line"></span><br><span class="line">                    if(j==0)&#123;</span><br><span class="line">                        </span><br><span class="line">                        // $(&quot;#ImgPr&quot;).attr(&apos;src&apos;,localId);</span><br><span class="line">                        // alert(localId);</span><br><span class="line"></span><br><span class="line">                        $(&quot;#ImgPr&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">                        $(&quot;.js_showBox&quot;).append(&quot;&lt;img src=&apos;&quot;+localId+&quot;&apos; /&gt;&quot;);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        $new=$(&quot;.imageitem&quot;).last().clone(true);</span><br><span class="line">                        $new.find(&apos;img&apos;).attr(&apos;src&apos;,res.localIds[j-upsum]);</span><br><span class="line">                        $new.insertAfter($(&quot;.imageitem&quot;).last());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // upsum=upsum+sum;</span><br><span class="line">                /*上传图片到微信服务器*/</span><br><span class="line">                var i=0;len=images.localId.length;</span><br><span class="line">                wxupload();</span><br><span class="line">                function wxupload()&#123;</span><br><span class="line">                    wx.uploadImage(&#123;</span><br><span class="line">                        localId: images.localId[i], // 需要上传的图片的本地ID，由chooseImage接口获得</span><br><span class="line">                        isShowProgressTips: 1, // 默认为1，显示进度提示</span><br><span class="line">                        success: function (res) &#123;</span><br><span class="line">                            // i++;</span><br><span class="line">                            //将上传成功后的serverId保存到serverid  </span><br><span class="line">                            // images.serverId.push(res.serverId);</span><br><span class="line">                            serverId1 = res.serverId;</span><br><span class="line">                            // alert(serverId1);</span><br><span class="line">                            // if(i &lt; len)&#123;</span><br><span class="line">                            //     wxupload();</span><br><span class="line">                            // &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    </span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);          </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src>
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title="0" data-url="http://link.hhtjim.com/163/5146554.mp3"></li>
                    
                        <li title="1" data-url="http://link.hhtjim.com/qq/001faIUs4M2zna.mp3"></li>
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-ae="false" data-ci data-cs data-r data-o data-a data-d="false">查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>